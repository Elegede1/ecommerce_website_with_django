{% extends "invApp/layout.html" %}

{% block title %}Product List{% endblock %}

{% block content %}
  <h1 class="text-center">Product List</h1>

  <!-- Search Bar -->
  <div class="row mb-3">
    <div class="col-md-6 offset-md-3">
      <form method="GET" action="{% url 'product_list' %}" class="d-flex">
        <input class="form-control me-2" type="search" name="q" placeholder="Search by name or SKU..." aria-label="Search" value="{{ request.GET.q }}">
        <button class="btn btn-outline-success" type="submit">Search</button>
      </form>
    </div>
  </div>
  <!-- End Search Bar -->

  {% if not products and request.GET.q %}
    <p class="text-center">No products found matching your search: "{{ request.GET.q }}"</p>
  {% elif not products %}
    <p class="text-center">No products available at the moment.</p>
  {% else %}
    <table class="table table-striped table-hover">
      <thead>
        <tr>
          <th>Image</th>
          <th>Name</th>
          <th>SKU</th>
          <th>Price</th>
          <th>Quantity Remaining</th>
          <th>Supplier</th>
          {% if user.is_authenticated %}
            <th>Actions</th>
          {% endif %}
        </tr>
      </thead>
      <tbody>
        {% for product in products %}
          <tr>
            <td>
              {% if product.image_url %}
                <img src="{{ product.image_url }}" alt="{{ product.name }}" style="width: 50px; height: 50px; object-fit: cover;">
              {% else %}
                <img src="https://via.placeholder.com/50" alt="No image" style="width: 50px; height: 50px; object-fit: cover;">
              {% endif %}
            </td>
            <td>{{ product.name }}</td>
            <td>{{ product.sku }}</td>
            <td>${{ product.price|floatformat:2 }}</td>
            <td>{{ product.quantity }}</td> {# This shows how many are remaining #}
            <td>{{ product.supplier }}</td>
            {% if user.is_authenticated %}
              <td>
                <a href="{% url 'product_update' product.product_id %}" class="btn btn-warning btn-sm">Update</a>
                <a href="{% url 'product_delete' product.product_id %}" class="btn btn-danger btn-sm">Delete</a>
              </td>
            {% endif %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% endif %}

  {% if user.is_authenticated %}
    <div class="text-center mt-3">
      <a href="{% url 'product_create' %}" class="btn btn-primary">Add New Product</a>
    </div>
  {% endif %}
{% endblock %}